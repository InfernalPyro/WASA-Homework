openapi: 3.0.3
info:
  title: WASAPhoto
  description: |-
    Keep in touch with your friends by sharing photos of special moments, thanks to WASAPhoto! You can
    upload your photos directly from your PC, and they will be visible to everyone following you.
  version: "1"
paths:

  /session:
    post:
      tags: ["login"]
      operationId: doLogin
      summary: Logs in the user
      description: |-
        If the user does not exist, it will be created,
        and an identifier is returned.
        If the user exists, the user identifier is returned.
      requestBody:
        description: User details
        content:
          application/json:
              schema:
                type: object
                properties:
                  name:
                    type: string
                    example: Maria
                    pattern: 'Ë†.*?$'
                    minLength: 3
                    maxLength: 16
        required: true
      responses:
        '201':
          description: User log-in action successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  userId:
                    type: integer
                    example: 10  

  /user/{userId}:  
    parameters: 
      - name: userId
        in: path
        description: The id of the logged user to delete
        required: true
        schema:
          type: integer
          format: int64
          example: 10
    delete:       
      tags: ["User"]
      operationId: deleteUser
      summary: Delete account
      description: |-
        A logged user can delete their account.
      responses:
        '201':
          description: Account deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'          
            application/xml:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: User is not logged  
        '404':
          description: User not found
      security:
        - Authentication: []

  /user/{userId}/profile: 
    parameters: 
      - name: userId
        in: path
        description: The id of the logged user
        required: true
        schema:
          type: integer
          format: int64
          example: 10
    get:
      tags: ["User"]
      summary: Get user profile 
      operationId: getUserProfile
      description: |-
        Returns the profile of the user with specified Id.
      responses:
        '201':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'          
            application/xml:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Invalid username supplied
        '404':
          description: User not found
      security:
        - Authentication: []

  /user/{userId}/home:
    parameters: 
      - name: userId
        in: path
        description: The id of the logged user
        required: true
        schema:
          type: integer
          format: int64
          example: 10
    get:
      tags: ["User"]
      summary: Get stream
      operationId: getMyStream
      description: |-
        Gets a stream of photos (images) in reverse chronological 
        order, with information about when each photo was uploaded 
        (date and time) and how many likes and comments it has.
      responses:
        '201':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Stream'          
            application/xml:
              schema:
                $ref: '#/components/schemas/Stream'
        '400':
          description: User is not logged
        '404':
          description: User not found
      security:
        - Authentication: []


  /user/{userId}/changeUsername:
    parameters: 
      - name: userId
        in: path
        description: The id of the logged user
        required: true
        schema:
          type: integer
          format: int64
          example: 10
    patch:       
      tags: ["Profile"]
      operationId: setMyUserName
      summary: Update user Username
      description: |-
        A logged user can change their username if logged
      requestBody:
        description: New username
        content:
          application/json:
            schema:
                type: object
                properties:
                  username:
                    type: string
                    minLength : 3
                    maxLength : 15
                    example: new Name
        required: true
      responses:
        '201':
          description: Username updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  username:
                    type: string
                    minLength : 3
                    maxLength : 15
                    example: new Name
        '400':
          description: User is not logged
        '401':
          description: New Username not valid
        '404':
          description: User not found
      security:
        - Authentication: []

  /user/{userId}/uploadPhoto:
    parameters: 
      - name: userId
        in: path
        description: The id of the logged user
        required: true
        schema:
          type: integer
          format: int64
          example: 10
    post:       
      tags: ["Profile"]
      operationId: uploadPhoto
      summary: Upload a new photo
      description: |-
        A logged user can upload a photo in their profile
      requestBody:
        description: Photo to upload
        content:
          image/*:    
            schema:
              type: string
              format: binary
      responses:
        '201':
          description: Photo uploaded
          content:
            application/json:
              schema:
                type: array    
                items:    
                  $ref: '#/components/schemas/Photo'
        '400':
          description: User is not logged 
        '401':
          description: Photo cannot be uploaded
        '404':
          description: User not found
      security:
        - Authentication: []

  /user/{userId}/photo:
    parameters: 
      - name: userId
        in: path
        description: ID of the user whose photos we want to get
        required: true
        schema:
          type: integer
          format: int64
          example: 10
    get:       
      tags: ["Profile"]
      operationId: getAllPhoto
      summary: Get all photos of user 
      description: |-
        Return entire collection of photos of the user specified in userId
      responses:
        '201':
          description: successful operation
          content:
            application/json:
              schema:
                type: array    
                items:    
                  $ref: '#/components/schemas/Photo'
        '400':
          description: User is not logged 
        '401':
          description: Photo cannot be found
        '404':
          description: User not found
      security:
        - Authentication: []

  /user/{userId}/photo/{photoId}:
    parameters: 
      - name: userId
        in: path
        description: The id of the logged user
        required: true
        schema:
          type: integer
          format: int64
          example: 10
    delete:       
      tags: ["Profile"]
      operationId: deletePhoto
      summary: Delete a photo
      description: |-
        A logged user can delete a photo they posted before
      parameters:
        - name: photoId
          in: path
          description: Id of the photo to delete
          required: true
          schema:
            type: integer
            format: int64
            example: 5
      responses:
        '201':
          description: Photo deleted
          content:
            application/json:
              schema:
                type: array    
                items:    
                  $ref: '#/components/schemas/Photo'
        '400':
          description: User is not logged  
        '401':
          description: Photo not found
        '404':
          description: User not found
      security:
        - Authentication: []

  /photo/{photoId}:
    get:       
      tags: ["Profile"]
      operationId: getPhoto
      summary: Get a single photo 
      description: |-
       Return photo specified by photoId
      parameters:
        - name: photoId
          in: path
          description: Id of the photo to get
          required: true
          schema:
            type: integer
            format: int64
            example: 5
      responses:
        '201':
          description: successful operation
          content:
            application/json:
               schema:
                 $ref: '#/components/schemas/Photo'
        '400':
          description: User is not logged 
        '401':
          description: Photo cannot be found
        '404':
          description: User not found
      security:
        - Authentication: []



  /user/{userId}/follow:  
    parameters: 
      - name: userId
        in: path
        description: The id of the logged user
        required: true
        schema:
          type: integer
          format: int64
          example: 10
    
    put:
      tags: ["User operations"]
      operationId: followUser
      summary: Follow another user
      description: |-
        An user can follow another user while on their profile page
      parameters: 
        - in: query
          name: followId
          required: true
          schema:
            type: integer
            format: int64
          description: The user to follow ID's
      responses:
        '201':
          description: User added to follow list
          content:
            application/json:
              schema:
                type: array    
                items:    
                  $ref: '#/components/schemas/User'
        '400':
          description: User is not logged  
        '404':
          description: User not found
      security:
        - Authentication: []

    delete:
      tags: ["User operations"]
      operationId: unfollowUser
      summary: Unfollow another user
      description: |-
           An user can unfollow another user
      parameters: 
          - in: query
            name: followId 
            required: true
            schema:
              type: integer
              format: int64
            description: The user to unfollow Id
      responses:
            '201':
              description: User removed from follow list
              content:
                application/json:
                  schema:
                    type: array    
                    items:    
                      $ref: '#/components/schemas/User'
            '400':
              description: User is not logged  
            '404':
              description: User not found
      security:
        - Authentication: []

  /user/{userId}/ban:      
    parameters: 
      - name: userId
        in: path
        description: The id of the logged user
        required: true
        schema:
          type: integer
          format: int64
          example: 10

    put:
      tags: ["User operations"]
      operationId: banUser
      summary: Ban another user
      description: |-
        An user can ban another user, blocking them from seeing their profile
      parameters: 
        - in: query
          name: banId 
          required: true
          schema:
            type: integer
            format: int64
          description: The user to ban Id
      responses:
        '201':
          description: User added to banned list
          content:
            application/json:
              schema:
                type: array    
                items:    
                  $ref: '#/components/schemas/User'
        '400':
          description: User is not logged  
        '404':
          description: User not found
      security:
        - Authentication: []

    delete:
      tags: ["User operations"]
      operationId: unbanUser
      summary: Unban another user
      description: |-
           An user can unban another user
      parameters: 
          - in: query
            name: banId
            required: true
            schema:
              type: integer
              format: int64
            description: The user to unban Id
      responses:
            '201':
              description: User removed from banned list
              content:
                application/json:
                  schema:
                    type: array    
                    items:    
                      $ref: '#/components/schemas/User'
            '400':
              description: User is not logged  
            '404':
              description: User not found
      security:
        - Authentication: []


  /user/{userId}/{photoId}/likes:   
    parameters: 
      - name: userId
        in: path
        description: The id of the logged user
        required: true
        schema:
          type: integer
          format: int64
          example: 10

    put:
      tags: ["Photo"]
      operationId: likePhoto
      summary: Like a photo
      description: |-
        An user can like a photo uploaded by anyone
      parameters: 
        - in: path
          name: photoId
          required: true
          schema:
            type: integer
            format: int64
          description: The photo to like Id's
      #requestBody:
      #  description: Add the userId to the photo likes list
      #  content:
      #      application/json:
      #        schema:
      #          type: object
      #          properties:
      #            userId:
      #              type: integer
      #              example: 10  
      responses:
        '201':
          description: Photo liked
          content:
            application/json:
              schema:
                type: array    
                items:    
                  $ref: '#/components/schemas/Photo'
        '400':
          description: User is not logged 
        '401':
          description: Photo not found
        '404':
          description: User not found
      security:
        - Authentication: []

    delete:
      tags: ["Photo"]
      operationId: unlikePhoto
      summary: Unlike a photo
      description: |-
           An user can unlike any photo they liked before
      parameters: 
          - in: path
            name: photoId 
            required: true
            schema:
              type: integer
              format: int64
            description: The photo to unlike Id's
      requestBody:
        description: Remove the userId to the photo likes list
        content:
            application/json:
              schema:
                type: object
                properties:
                  userId:
                    type: integer
                    example: 10  
      responses:
            '201':
              description: Photo Unliked
              content:
                application/json:
                  schema:
                    type: array    
                    items:    
                      $ref: '#/components/schemas/Photo'
            '400':
              description: User is not logged 
            '401':
              description: Photo not found
            '404':
              description: User not found
      security:
        - Authentication: []

  /user/{userId}/{photoId}/comments:      
    parameters: 
      - name: userId
        in: path
        description: The id of the logged user
        required: true
        schema:
          type: integer
          format: int64
          example: 10

    put:
      tags: ["Photo"]
      operationId: commentPhoto
      summary: Comment a photo
      description: |-
        An user can make a comment on any photo
      parameters: 
        - in: path
          name: photoId
          required: true
          schema:
            type: integer
            format: int64
          description: The photo to comment Id's
      requestBody:
        description: Add a comment to the photo comments list
        content:
          application/json:
              schema:
                $ref: '#/components/schemas/Comment'          
          application/xml:
              schema:
                $ref: '#/components/schemas/Comment'
      responses:
        '201':
          description: Comment added to photo
          content:
            application/json:
              schema:
                type: array    
                items:    
                  $ref: '#/components/schemas/Comment'
        '400':
          description: User is not logged
        '401':
          description: Photo not found
        '402':
          description: Comment not found
        '404':
          description: User not found
      security:
        - Authentication: []

    delete:
      tags: ["Photo"]
      operationId: uncommentPhoto
      summary: Delete a comment
      description: |-
           An user can delete any comments they made
      parameters:    
          - in: path
            name: photoId
            required: true
            schema:
              type: integer
              format: int64
            description: The photo with the comment Id's      
          - in: query   
            name: commentId 
            required: true
            schema:
              type: integer
              format: int64
            description: The comment to delete Id's
      responses:
            '201':
              description: Comment deleted
              content:
                application/json:
                  schema:
                    type: array    
                    items:    
                      $ref: '#/components/schemas/Comment'
            '400':
              description: User is not logged
            '401':
              description: Photo not found
            '402':
              description: Comment not found
            '404':
              description: User not found
      security:
        - Authentication: []
  
  /photo/{photoId}/comments:
    get:       
      tags: ["Photo"]
      operationId: getAllComments
      summary: Get all comments of photo
      description: |-
       Return every comment on the photo specified by photoId
      parameters:
        - name: photoId
          in: path
          description: Id of the photo to get
          required: true
          schema:
            type: integer
            format: int64
            example: 5
      responses:
        '200':
          description: successful operation
          content:
            application/json:
               schema:
                type: array
                items:
                  $ref: '#/components/schemas/Comment'
        '400':
          description: User is not logged 
        '401':
          description: Photo cannot be found
        '404':
          description: User not found
      security:
        - Authentication: []
      


components:
  schemas:
    User:
      type: object
      properties:
        userId:
          type: integer
          format: int64
          example: 10
        username:
          type: string
          minLength : 3
          maxLength : 15
          example: MyName
        follows: 
          type: array
          items: 
            $ref: '#/components/schemas/User'
          example:
            - id: 11
              username: Marco
            - id: 12
              username: Carlo
        followers: 
          type: array
          items: 
            $ref: '#/components/schemas/User'
          example:
            - id: 13
              username: Lucia
        banned: 
          type: array
          items: 
            $ref: '#/components/schemas/User'
          example:
            - id: 9
              username: Luca
        photos: 
          type: array
          items: 
            $ref: '#/components/schemas/Photo'
      xml:
        name: user
    
    Photo:
      type: object
      properties:
        photoId:  
          type: integer
          format: int64
          example: 72
        userId:
          type: integer
          format: int64
          example: 10
        image:
          type: string
          format: binary
        time:
          type: string
          format: date-time
          example: 2022-11-10T117:32:28Z
        likes:
          type: array
          items:
            type: string
        comments:
          type: array
          items:
            $ref: '#/components/schemas/Comment'
      xml:
        name: photo

    Comment:
      type: object
      properties:
        commentId:
          type: integer
          format: int64
          example: 3
        photoId:
          type: integer
          format: int64
          example: 72
        userId:
          type: integer
          format: int64
          example: 10
        comment:
          type: string
          example: This is a comment
        time:
          type: string
          format: date-time
          example: 2022-11-10T117:32:28Z
      xml:
        name: comment

    Stream:
      type: object
      properties:
        photos:
          type: array
          items: 
            $ref: '#/components/schemas/Photo'
      xml:
        name: stream
  
  securitySchemes:
    Authentication:     
      type: http
      scheme: bearer
      bearerFormat: JWT 
